<!DOCTYPE html>
<html>
	<head>
		<title>RfConnectErr</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0" />
		<meta charset="utf-8" />

		<link href="../css/base.css" rel="stylesheet" type="text/css" />
		<link href="../css/s01.css" rel="stylesheet" type="text/css" />
		<script src="../js/rfid.js"></script>

		<style type="text/css">
		</style>
	</head>

	<body>
		<div id="boso" class="boso Lc_noadr">
			<div id="devsDom" class="barBody midOut bfs">
				<br/><br/><br/><br/><br/>刷新中。。。
			</div>
			<div id="btnDom" class="Lc_nosee">
				<div class="btn btn1" onclick="dat.scan();">
					<div class="midTop"></div>
					<div class="midSub mfs">刷新</div>
				</div>
			</div>
		</div>
		<div id="memoDom" class="memo"></div>
	</body>

	<script type="text/javascript">
		document.body.onload = rfid.bleScan;
		rfid.bleScanEnd = function (dev) {
			dat.clearNan();
			btnDom.className = "bar";
		};
		rfid.bleScanDev = function (dev) {
			if (dev.typ === 2 && dev.rsi < -20) {
				dat.clearNan();
				var d = document.createElement("br");
				devsDom.appendChild(d);
				d = document.createElement("br");
				devsDom.appendChild(d);
				d = document.createElement("br");
				devsDom.appendChild(d);
				d = document.createElement("a");
				d.href = "javascript: dat.link(\"" + dev.adr + "\");";
				d.innerHTML = dev.adr;
				if (dev.nam) {
					d.innerHTML += " (" + dev.nam + ")";
				}
				devsDom.appendChild(d);
			}
		};
		var dat = {
			nan: true,
			scan: function () {
				btnDom.className = "Lc_nosee";
				devsDom.innerHTML = "<br/><br/><br/><br/><br/>刷新中。。。";
				dat.nan = true;
				rfid.bleScan();
			},
			link: function (adr) {
				rfid.setDev(adr);
				window.location.href = "linking.html";
			},
			clearNan: function () {
				if (dat.nan) {
					devsDom.innerHTML = "";
					dat.nan = false;
				}
			}
		};
	</script>
</html>
